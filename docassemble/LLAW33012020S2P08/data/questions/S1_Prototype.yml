---
#Code to enable endpoint event
objects:
  - endpoint: DADict
---
#Code to include seperately maintained threshold table
include: 
  - Threshold_Tables_2.yml  
  - S1_Question_Folder.yml
  - Prototype_if_code_block.yml

---
# Welcome Page
mandatory: True
question: Disclaimer Page
subquestion: |
  This application is only intended to be used to gauge whether you still qualify for the DSP or how much DSP will be deducted, based on the hours and income of your work.

  Do you wish to continue?
buttons:
  - "Yes": continue
  - "No": exit  
---
# This is the 1ST ineligible endpoint
event: endpoint['ineligible_1']
question: Eligibility requirements not met
subquestion:
  You are not eligible to use this application as you have indicated that you are **not** in recipet of the DSP.

buttons:
  - Exit: exit
  - Learn More: logout
    url: https://www.servicesaustralia.gov.au/individuals/services/centrelink/disability-support-pension
  - Restart: restart
---  
# This is the 2ND ineligible endpoint
event: endpoint['ineligible_2']
question: Eligibility requirements not met
subquestion: |

  * You are not eligible to use this application as you have indicated that you work more than 30 hours a week.

  * Your DSP may be affected if you work for 30 hours or more a week.
  
  * Please visit the centerlink website for more information.
  
buttons:
  - Exit: exit
  - Learn More: logout
    url: https://www.servicesaustralia.gov.au/individuals/services/centrelink/disability-support-pension/how-manage-your-payment/hours-you-can-work#:~:text=You%20may%20be%20able%20to,than%2030%20hours%20a%20week.
  - Restart: restart
---
# This is the 3RD ineligible endpoint for 
event: endpoint['ineligible_3']
question: Eligibility requirements not met
subquestion: |
 You have provided us with the following information. 
 
 Your income **exceeds** the DSP cut off point and **will not** recieve any DSP.

  Question|Answer
  ---|---
  **Hours you work per week**| ${ user_hours } hours
  **Your age**| ${ P08age }
  ** Do you have any dependent children? ** | ${ P08has_chn }
  **Your maritial status**| ${ P08is_married }
  % if P08is_married != 'Single' and P08age_category == 'over_21':
  ** Are you living apart or together?**| ${ P08_married_apart }
  % endif
  % if P08age_category == 'under_18' or P08age_category == '18to20' and P08chn_cat == 'no_chn' and P08is_married == 'Single':
  ** Are you living at home or independently?**| ${ P08_Dependence }
  % endif
  **Your income per fortnight**| ${ currency(P08income) }

buttons:
  - Exit: exit
  - Learn More: logout
    url: https://www.servicesaustralia.gov.au/individuals/services/centrelink/disability-support-pension/who-can-get-it/non-medical-rules/income-and-assets-tests/income-test-pensions
  - Restart: restart
---
# This is the ELIGIBLE endpoint
event: endpoint['eligible']
question: You have reached the end
subquestion: | 
 You have provided us with the following information. 
 
 The amount of DSP which will be deducted is stated at the bottom of the table.

  Question|Answer
  ---|---
  **Hours you work per week**| ${ user_hours } hours
  **Your age**| ${ P08age }
  ** Do you have any dependent children? ** | ${ P08has_chn }
  **Your relationship status**| ${ P08is_married }
  % if P08is_married != 'Single' and P08age_category == 'over_21':
  ** Are you living apart or together?**| ${ P08_married_apart }
  % endif
  % if P08age_category != 'over_21' and P08chn_cat == 'no_chn' and P08is_married == 'Single':
  ** Are you living at home or independently?**| ${ P08_Dependence }
  % endif
  **Your income per fortnight**| ${ currency(P08income) }
  **Your current DSP is** | ${ currency(P08dspincome) }
  **How much DSP is deducted**| ${ currency(amount_deducted) }
 
buttons:  
 - Exit: exit
 - Try Again: restart
---
#Code to run threshold - eligible OR ineligible 
mandatory: True
code: |
  if user_DSP == 'No':
    endpoint['ineligible_1']
  elif user_hours >= 30:
    endpoint['ineligible_2']
  elif P08income > my_thresholds['DSP_cutoff']:
    endpoint['ineligible_3']
  else:
    endpoint['eligible']
  
---
code: |
  temp_income = P08income - my_no_pen
  amount_deducted = temp_income / my_ded_incr * my_ded_amt
---
code: |
  my_thresholds = threshold_table[P08age_category][P08chn_cat][P08is_married][P08fourth_subcat]
  my_DSP_cutoff = my_thresholds['DSP_cutoff']
  my_no_pen = my_thresholds['no_pen_thr']
  my_ded_amt = my_thresholds['ded_amt']
  my_ded_incr = my_thresholds['ded_inc']
---
